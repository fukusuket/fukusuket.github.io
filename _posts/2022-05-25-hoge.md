---
layout: post
title:  "hoge."
date:   2022-05-25
---

# ref

- [Warning lists · User guide of MISP](https://www.circl.lu/doc/misp/warninglists/)
- [MISP/misp-warninglists](https://github.com/MISP/misp-warninglists)
- [PyMISP.search](https://pymisp.readthedocs.io/en/latest/_modules/pymisp/api.html#PyMISP.search)
- [PyMISP.values_in_warninglist](https://pymisp.readthedocs.io/en/latest/_modules/pymisp/api.html#PyMISP.values_in_warninglist)
- [PyMISPWarningLists]https://github.com/MISP/PyMISPWarningLists

# warninglist
## memo
- jsonで定義。自分であとからカスタムで追加可能。jsonスキーマは単純
- プリセットされてるので71リスト
  - クラウドサービスip range
  - Google系
  - Microsoft系
  - public dns ip
  - top xxx sites
- リスト毎にマッチ方式が定義されている。方式は以下の通り。プリセットされてるものの大半はstring
  - string ... 完全一致
  - hostname ... 完全一致
  - substring ... 部分一致
  - cidr ... アドレス範囲マッチ
- あとから有効化可能。Event登録時に有効でなくてもOK

## memo
- results

# code1

setup
```
pip install pymisp
```

```Python
from pymisp import PyMISP

import urllib3
from urllib3.exceptions import InsecureRequestWarning
urllib3.disable_warnings(InsecureRequestWarning)  # warningがでるため自己署名証明書チェックスキップ

# PyMISPインスタンス生成
KEY = "misp auth_key"
URL = "misp url"
misp = PyMISP(URL, KEY, False)

# warninglistにマッチしなかったattributeだけprint
results = misp.search(controller="attributes", enforce_warninglist=True)
if results:
    for attribute in results["Attribute"]:
        print(f"misp.search: {attribute}")

# 有効化したwarninglistの中でsearch_valueにマッチするwarninglistがあったらprint
search_value = "amazonaws.com"
results = misp.values_in_warninglist(search_value)
if results:
    for r in results[search_value]:
        print(f"misp.values_in_warninglist: {r}")
```


# code2

setup
```
pip install pymispwarninglist
```

```Python
from pymispwarninglists import WarningLists

warninglists = WarningLists(slow_search=True)
search_value = "amazonaws.com"
r = warninglists.search(search_value)
if r:
    print("Hit found for %s in warninglists" % (search_value))
    for hit in r:
        print(" %s %s %s %s" % (hit.type, hit.name, hit.version, hit.description))
```

## pros
- タグ不要
- false positive機能の自作が不要
- GUIでパット見わかる
- あとから有効化・無効化可能
- コミュニティの知見が利用可能
  - globalな有名どころサービスはある程度カバーしてる

## cons
- seaver sync filterには使えない
- プリセットではfalse poitiveを完全に抑制できない（特に日本サイト）
  - 足りない分はカスタムjsonで